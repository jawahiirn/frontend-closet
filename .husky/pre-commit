#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check for console statements
CONSOLE_FOUND=false

for FILE in $STAGED_FILES; do
  if [ -f "$FILE" ]; then
    # Check for console.log, console.warn, console.error, etc.
    MATCHES=$(grep -n -E 'console\.(log|warn|error|info|debug|trace)' "$FILE" 2>/dev/null)
    if [ -n "$MATCHES" ]; then
      CONSOLE_FOUND=true
      echo "âŒ Console statements found in: ${FILE}" >&2
      echo "${MATCHES}" | while IFS= read -r line; do
        echo "   Line: $line" >&2
      done
      echo "" >&2
    fi
  fi
done

if [ "$CONSOLE_FOUND" = true ]; then
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" >&2
  echo "âŒ COMMIT REJECTED!" >&2
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" >&2
  echo "" >&2
  echo "Reason: Console statements detected in staged files (see above)" >&2
  echo "" >&2
  echo "ðŸ“ What to do:" >&2
  echo "   â€¢ Remove the console statements and try again" >&2
  echo "   â€¢ Add '// eslint-disable-next-line no-console' above specific lines" >&2
  echo "   â€¢ Use 'git commit --no-verify' to bypass this check (not recommended)" >&2
  echo "" >&2
  exit 1
fi

echo "âœ… No console statements found - commit allowed" >&2
echo "" >&2
exit 0
