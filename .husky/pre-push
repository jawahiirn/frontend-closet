#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo ""
echo "ğŸ” Checking branch naming convention..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)
VALID_PREFIXES="^(update|fixing|chore|config|feature)"

if ! echo "$BRANCH_NAME" | grep -qE "$VALID_PREFIXES"; then
  echo "âŒ Push blocked! Invalid branch name: $BRANCH_NAME"
  echo ""
  echo "Branch names must start with one of the following prefixes:"
  echo "  â€¢ update"
  echo "  â€¢ fixing"
  echo "  â€¢ chore"
  echo "  â€¢ config"
  echo "  â€¢ feature"
  echo ""
  echo "Example: feature/new-login-page"
  echo ""
  exit 1
fi

echo "âœ… Branch name '$BRANCH_NAME' is valid"
echo ""

echo "ğŸ” Running knip to check for unused code..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Change to the pokedex-web directory where package.json and knip.json are located
cd pokedex-web || exit 1

npm run knip

KNIP_EXIT_CODE=$?

echo ""
if [ $KNIP_EXIT_CODE -ne 0 ]; then
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "âš ï¸  WARNING: Knip found unused code (see above)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "ğŸ“ This is informational only - your push will continue."
  echo "   Please review the unused code and remove it when appropriate."
  echo ""
  echo "   To block pushes with unused code, edit .husky/pre-push"
  echo ""
else
  echo "âœ… No unused code found - push allowed"
  echo ""
fi

exit 0
